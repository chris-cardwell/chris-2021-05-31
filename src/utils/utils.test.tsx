import { UsdDenomination, OrderData, OrderWithTotal } from "../types";
import { groupAndTotalOrders } from "./utils";
const xbtMockData: OrderData = {
  "3436750": { price: 34367.5, size: 902981 },
  "3578750": { price: 35787.5, size: 29947 },
  "3591250": { price: 35912.5, size: 16346 },
  "3592150": { price: 35921.5, size: 1 },
  "3592200": { price: 35922, size: 526 },
  "3593750": { price: 35937.5, size: 499 },
  "3595600": { price: 35956, size: 8000 },
  "3598200": { price: 35982, size: 29947 },
  "3598250": { price: 35982.5, size: 247545 },
  "3598300": { price: 35983, size: 118004 },
  "3604000": { price: 36040, size: 70610 },
  "3604050": { price: 36040.5, size: 663290 },
  "3607100": { price: 36071, size: 244220 },
  "3607700": { price: 36077, size: 2000 },
  "3608050": { price: 36080.5, size: 254100 },
  "3610000": { price: 36100, size: 50000 },
  "3610200": { price: 36102, size: 488432 },
  "3610250": { price: 36102.5, size: 708002 },
  "3611200": { price: 36112, size: 29947 },
  "3611300": { price: 36113, size: 2580 },
  "3614250": { price: 36142.5, size: 2580 },
  "3614350": { price: 36143.5, size: 25116 },
  "3614550": { price: 36145.5, size: 439588 },
  "3615300": { price: 36153, size: 192000 },
  "3615400": { price: 36154, size: 25109 },
  "3615450": { price: 36154.5, size: 503557 },
  "3615800": { price: 36158, size: 787 },
  "3617700": { price: 36177, size: 29947 },
  "3618550": { price: 36185.5, size: 2580 },
  "3618900": { price: 36189, size: 96000 },
  "3618950": { price: 36189.5, size: 390745 },
  "3619000": { price: 36190, size: 2500 },
  "3619050": { price: 36190.5, size: 2063 },
  "3619300": { price: 36193, size: 51025 },
  "3619350": { price: 36193.5, size: 590001 },
  "3620500": { price: 36205, size: 2500 },
  "3620550": { price: 36205.5, size: 2079 },
  "3620850": { price: 36208.5, size: 806 },
  "3621850": { price: 36218.5, size: 5503 },
  "3621950": { price: 36219.5, size: 2500 },
  "3622350": { price: 36223.5, size: 19930 },
  "3622450": { price: 36224.5, size: 2720 },
  "3623000": { price: 36230, size: 2006 },
  "3623050": { price: 36230.5, size: 240000 },
  "3623300": { price: 36233, size: 50500 },
  "3623350": { price: 36233.5, size: 312596 },
  "3623400": { price: 36234, size: 199 },
  "3624050": { price: 36240.5, size: 3632 },
  "3624100": { price: 36241, size: 65790 },
  "3624150": { price: 36241.5, size: 30146 },
  "3624250": { price: 36242.5, size: 2720 },
  "3624300": { price: 36243, size: 1901 },
  "3624400": { price: 36244, size: 9710 },
  "3624450": { price: 36244.5, size: 4940 },
  "3624650": { price: 36246.5, size: 2658 },
  "3624850": { price: 36248.5, size: 538 },
  "3624950": { price: 36249.5, size: 1969 },
  "3625100": { price: 36251, size: 2500 },
  "3625150": { price: 36251.5, size: 2562 },
  "3625200": { price: 36252, size: 113937 },
  "3625350": { price: 36253.5, size: 4548 },
  "3625850": { price: 36258.5, size: 71611 },
  "3625900": { price: 36259, size: 232014 },
  "3626050": { price: 36260.5, size: 1861 },
  "3626200": { price: 36262, size: 2564 },
  "3626400": { price: 36264, size: 64307 },
  "3626450": { price: 36264.5, size: 7500 },
  "3626550": { price: 36265.5, size: 3959 },
  "3626650": { price: 36266.5, size: 2500 },
  "3626950": { price: 36269.5, size: 2441 },
  "3627050": { price: 36270.5, size: 118771 },
  "3627200": { price: 36272, size: 68110 },
  "3627250": { price: 36272.5, size: 119497 },
  "3627350": { price: 36273.5, size: 17004 },
  "3627400": { price: 36274, size: 169999 },
  "3627450": { price: 36274.5, size: 51834 },
  "3627550": { price: 36275.5, size: 19999 },
  "3627800": { price: 36278, size: 175835 },
  "3627850": { price: 36278.5, size: 66237 },
  "3627950": { price: 36279.5, size: 981 },
  "3628050": { price: 36280.5, size: 24000 },
  "3628100": { price: 36281, size: 10556 },
  "3628150": { price: 36281.5, size: 15000 },
  "3628250": { price: 36282.5, size: 5000 },
  "3628450": { price: 36284.5, size: 42835 },
  "3628500": { price: 36285, size: 56123 },
  "3628550": { price: 36285.5, size: 20000 },
  "3628600": { price: 36286, size: 62433 },
  "3628700": { price: 36287, size: 17297 },
  "3628950": { price: 36289.5, size: 60000 },
  "3629000": { price: 36290, size: 1022 },
  "3629050": { price: 36290.5, size: 20000 },
  "3629100": { price: 36291, size: 30400 },
  "3629150": { price: 36291.5, size: 347 },
  "3629300": { price: 36293, size: 960 },
  "3630250": { price: 36302.5, size: 11243 },
  "3630300": { price: 36303, size: 1037 },
};

const xbtExpectedFiftyCentGrouping: OrderWithTotal[] = [
  { price: 34367.5, size: 902981, total: 902981 },
  { price: 35787.5, size: 29947, total: 932928 },
  { price: 35912.5, size: 16346, total: 949274 },
  { price: 35921.5, size: 1, total: 949275 },
  { price: 35922, size: 526, total: 949801 },
  { price: 35937.5, size: 499, total: 950300 },
  { price: 35956, size: 8000, total: 958300 },
  { price: 35982, size: 29947, total: 988247 },
  { price: 35982.5, size: 247545, total: 1235792 },
  { price: 35983, size: 118004, total: 1353796 },
  { price: 36040, size: 70610, total: 1424406 },
  { price: 36040.5, size: 663290, total: 2087696 },
  { price: 36071, size: 244220, total: 2331916 },
  { price: 36077, size: 2000, total: 2333916 },
  { price: 36080.5, size: 254100, total: 2588016 },
  { price: 36100, size: 50000, total: 2638016 },
  { price: 36102, size: 488432, total: 3126448 },
  { price: 36102.5, size: 708002, total: 3834450 },
  { price: 36112, size: 29947, total: 3864397 },
  { price: 36113, size: 2580, total: 3866977 },
  { price: 36142.5, size: 2580, total: 3869557 },
  { price: 36143.5, size: 25116, total: 3894673 },
  { price: 36145.5, size: 439588, total: 4334261 },
  { price: 36153, size: 192000, total: 4526261 },
  { price: 36154, size: 25109, total: 4551370 },
  { price: 36154.5, size: 503557, total: 5054927 },
  { price: 36158, size: 787, total: 5055714 },
  { price: 36177, size: 29947, total: 5085661 },
  { price: 36185.5, size: 2580, total: 5088241 },
  { price: 36189, size: 96000, total: 5184241 },
  { price: 36189.5, size: 390745, total: 5574986 },
  { price: 36190, size: 2500, total: 5577486 },
  { price: 36190.5, size: 2063, total: 5579549 },
  { price: 36193, size: 51025, total: 5630574 },
  { price: 36193.5, size: 590001, total: 6220575 },
  { price: 36205, size: 2500, total: 6223075 },
  { price: 36205.5, size: 2079, total: 6225154 },
  { price: 36208.5, size: 806, total: 6225960 },
  { price: 36218.5, size: 5503, total: 6231463 },
  { price: 36219.5, size: 2500, total: 6233963 },
  { price: 36223.5, size: 19930, total: 6253893 },
  { price: 36224.5, size: 2720, total: 6256613 },
  { price: 36230, size: 2006, total: 6258619 },
  { price: 36230.5, size: 240000, total: 6498619 },
  { price: 36233, size: 50500, total: 6549119 },
  { price: 36233.5, size: 312596, total: 6861715 },
  { price: 36234, size: 199, total: 6861914 },
  { price: 36240.5, size: 3632, total: 6865546 },
  { price: 36241, size: 65790, total: 6931336 },
  { price: 36241.5, size: 30146, total: 6961482 },
  { price: 36242.5, size: 2720, total: 6964202 },
  { price: 36243, size: 1901, total: 6966103 },
  { price: 36244, size: 9710, total: 6975813 },
  { price: 36244.5, size: 4940, total: 6980753 },
  { price: 36246.5, size: 2658, total: 6983411 },
  { price: 36248.5, size: 538, total: 6983949 },
  { price: 36249.5, size: 1969, total: 6985918 },
  { price: 36251, size: 2500, total: 6988418 },
  { price: 36251.5, size: 2562, total: 6990980 },
  { price: 36252, size: 113937, total: 7104917 },
  { price: 36253.5, size: 4548, total: 7109465 },
  { price: 36258.5, size: 71611, total: 7181076 },
  { price: 36259, size: 232014, total: 7413090 },
  { price: 36260.5, size: 1861, total: 7414951 },
  { price: 36262, size: 2564, total: 7417515 },
  { price: 36264, size: 64307, total: 7481822 },
  { price: 36264.5, size: 7500, total: 7489322 },
  { price: 36265.5, size: 3959, total: 7493281 },
  { price: 36266.5, size: 2500, total: 7495781 },
  { price: 36269.5, size: 2441, total: 7498222 },
  { price: 36270.5, size: 118771, total: 7616993 },
  { price: 36272, size: 68110, total: 7685103 },
  { price: 36272.5, size: 119497, total: 7804600 },
  { price: 36273.5, size: 17004, total: 7821604 },
  { price: 36274, size: 169999, total: 7991603 },
  { price: 36274.5, size: 51834, total: 8043437 },
  { price: 36275.5, size: 19999, total: 8063436 },
  { price: 36278, size: 175835, total: 8239271 },
  { price: 36278.5, size: 66237, total: 8305508 },
  { price: 36279.5, size: 981, total: 8306489 },
  { price: 36280.5, size: 24000, total: 8330489 },
  { price: 36281, size: 10556, total: 8341045 },
  { price: 36281.5, size: 15000, total: 8356045 },
  { price: 36282.5, size: 5000, total: 8361045 },
  { price: 36284.5, size: 42835, total: 8403880 },
  { price: 36285, size: 56123, total: 8460003 },
  { price: 36285.5, size: 20000, total: 8480003 },
  { price: 36286, size: 62433, total: 8542436 },
  { price: 36287, size: 17297, total: 8559733 },
  { price: 36289.5, size: 60000, total: 8619733 },
  { price: 36290, size: 1022, total: 8620755 },
  { price: 36290.5, size: 20000, total: 8640755 },
  { price: 36291, size: 30400, total: 8671155 },
  { price: 36291.5, size: 347, total: 8671502 },
  { price: 36293, size: 960, total: 8672462 },
  { price: 36302.5, size: 11243, total: 8683705 },
  { price: 36303, size: 1037, total: 8684742 },
];

describe("utils", () => {
  it("getOrderTotals full data correctly", () => {
    const result = groupAndTotalOrders(
      xbtMockData,
      UsdDenomination.FiftyCents,
      false,
      Object.values(xbtMockData).length
    );

    expect(result).toStrictEqual(
      xbtExpectedFiftyCentGrouping.slice(0, Object.values(xbtMockData).length)
    );
  });

  it("groups data correctly", () => {
    const mockData: OrderData = {
      //group one
      "100": { price: 1, size: 100 },
      "125": { price: 1.25, size: 110 },
      "149": { price: 1.49, size: 120 },
      //group two
      "150": { price: 1.5, size: 350 },
      "175": { price: 1.75, size: 400 },
      "199": { price: 1.99, size: 700 },
    };

    const result = groupAndTotalOrders(mockData, UsdDenomination.FiftyCents);

    expect(result).toStrictEqual([
      {
        price: 1,
        size: 100 + 110 + 120,
        total: 100 + 110 + 120,
      },
      {
        price: 1.5,
        size: 350 + 400 + 700,
        total: 100 + 110 + 120 + 350 + 400 + 700,
      },
    ]);
  });

  it("slices before returning if specified", () => {
    const result = groupAndTotalOrders(
      xbtMockData,
      UsdDenomination.FiftyCents,
      false,
      10
    );
    expect(result).toStrictEqual(xbtExpectedFiftyCentGrouping.slice(0, 10));
  });
});
